<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>A short story about how Finland is helping 2 million Syrian refugees</title>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>

<style>
body {
    font-family: Arial;
    text-align: center;
    background-color: #333;
    color: white;
}
a, a:visited, a:active, a:hover {
    color: inherit;
    text-decoration: none;
}
.row1 {
    width: 4px;
    margin: 0 1px;
}
.row1, .row200, .row2000 {
    margin-bottom: 4px;
}
h1 {
    font-size: 80px;
    width: 700px;
    display: inline-block;
    margin-top: 200px;
    margin-bottom: 500px;
}
h2 {
    font-size: 36px;
    width: 900px;
    display: inline-block;
}
.button {
    display: inline-block;
    background-color: rgb(214, 83, 83);
    padding: 7px;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 15px;
}
.break {
    margin: 14px 16px 18px;
    font-size: 39px;
    font-weight: bold;
}
.color {
    color: rgb(214, 83, 83);
}
#share {
    margin: 30px;
    margin-top: 100px;
}
#credit {
    font-size: 13px;
}

</style>
</head>

<body>
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/sv_SE/all.js#xfbml=1&appId=589389644451916";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>

    
    <div id="container"><a href="javascript:scrollTo('h0', 500)"><h1 id="top"></h1></a></div>
    <div id="share" class="block">
    <div class="fb-like" data-href="http://jplusplus.se/u/syria" data-width="300" data-colorscheme="dark" data-layout="button_count" data-action="recommend" data-show-faces="true" data-send="false"></div>
        
        <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jplusplus.se/u/syria" data-via="jensfinnas">Tweet</a>
    </div>

    <div id="credit">
        <strong>Sources:</strong> <a href="http://yle.fi/uutiset/interior_minister_finland_could_take_in_500_syrian_refugees/6838793" target="_blank" id="source">Yle</a>, <a href="http://data.unhcr.org/syrianrefugees/regional.php">UNHCR</a>.<br>
    <a href="http://jplusplus.se" target="_blank">Jens Finn√§s, Journalism++ Stockholm</a></div>


<script>

    function in_array (needle, haystack, argStrict) {
      var key = '',
        strict = !! argStrict;

      if (strict) {
        for (key in haystack) {
          if (haystack[key] === needle) {
            return true;
          }
        }
      } else {
        for (key in haystack) {
          if (haystack[key] == needle) {
            return true;
          }
        }
      }
      return false;
    }

    function addCommas(nStr) {
        nStr += '';
        var x = nStr.split('.');
        var x1 = x[0];
        var x2 = x.length > 1 ? '.' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        while (rgx.test(x1)) {
            x1 = x1.replace(rgx, '$1' + ',' + '$2');
        }
        return x1 + x2;
    }
    function getParameterByName(name) {
        name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
            results = regex.exec(location.search);
        return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }

    // Scroll to headline with given id
    function scrollTo(h, time){
        var aTag = $("#"+h);
        $('html,body').animate({scrollTop: aTag.offset().top},time);
    }

    function drawIcons(n) {
        // Count number of image blocks
        var n2000 = Math.floor(n / 2000);
        var n200  = Math.floor((n - n2000 * 2000) / 200);
        var n1    = Math.floor(n - n2000 * 2000 - n200 * 200);
        // Draw 2000 item blocks
        for (var j=0; j<n2000; j++) {
            if (j%25==0 && j!==0) cont.append('<div class="break">'+addCommas(j*2000)+'</div>')             
            cont.append('<img src="{{ url_for("static", filename="2000.png") }}" class="row2000"/><br>');
        }
        // Draw 200 item blocks
        for (var j=0; j<n200; j++) {
            cont.append('<img src="{{ url_for("static", filename="200.png") }}" class="row200"/><br>');             
        }
        // Draw single items
        for (var j=0; j<n1; j++) {
            cont.append('<img src="{{ url_for("static", filename="1.png") }}" class="row1"/>');             
        }
    }

    var cont = $("#container");

    function translate(data, code_country) {
        if (Array.isArray(data)) {
            var translated = [];
            for(var i=0; i<data.length; i++) {
                translated[i] = translate(data[i], code_country);
            }
        } else {
            // object
            var translated = {};
            for (var key in data) {
                if (key=='countries') { // exception for countries using region codes
                   translated['countries'] = translate(data[key], code_country);
                } else if (typeof(data[key]) == "object") {
                    translated[key] = translate(data[key], code_country);
                } else {
                    if (key == code_country) {
                        return data[key];
                    } else {
                        translated[key] = data[key];
                    }
                }
            }
        }
        return translated;
    }

    $.getJSON("{{ url_for('static', filename="locales.json")}}", function(data) {

        var code_country  = getParameterByName("cn") || "fi";
        var code_language = getParameterByName("ln") || "en";

        var country = translate(data['countries'], code_language)[code_country];
        var story   = translate(data['story']    , code_language);
        var locales = translate(data['locales']  , code_language);

        for (var i=0; i<story.length; i++) {
            var d   = story[i];
            var str = d.name.replace("#NUMBER#", addCommas(d.value))
            // Add heading
            cont.append('<h2 id="h'+i+'"><a href="javascript:scrollTo(\'h'+(i+1)+'\', '+(d.value/100)+')">'+str+' <br><div class="button">Tell me more</div></a></h2>');
            // Draw icons
            drawIcons(d.value);
        }
        // Add final national heading
        cont.append('<h2 id="h'+story.length+'">'+country["sentence"].replace("#NUMBER#", "<span class=\"color\">"+country["helping"]+"</span>")+'<br>But hey, we can\'t help everyone.</h2><br>');
        // Draw icons
        drawIcons(country["helping"]);

        // Scroll to top
        cont.append('<br><br><br><br><br><div class="button"><a href="javascript:scrollTo(\'top\', 2000)">Back to top</a></div>');      
        // Set country specific content
        $('h1').html(locales['title'].replace("#COUNTRY#", country["name"]));
        $('title').html(locales['title'].replace("#COUNTRY#", country["name"]));
        $('.fb-like').attr('data-href', url);
        $('.twitter-share-button').attr('data-url', url);
        $('#source').text(country["source"]["name"]).attr('href', country["source"]["url"]);

    });

// twitter share
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44179248-1', 'jplusplus.se');
  ga('send', 'pageview');

</script>   
</body>
</html>